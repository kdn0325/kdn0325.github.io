---
title: "[React Native] S3 ì—°ë™ ìŠ¤í† ë¦¬ì§€ => ì´ë¯¸ì§€ ì—…ë¡œë“œ"

categories: frontend

comments: true
tags:
  - React-Native
  - react-native-url-polyfill
  - react-native-image-picker
  - @aws-sdk/client-s3
  - @aws-sdk/lib-storage
  - buffer
  - react-native-get-random-values
  - react-native-fs
  - IAM ì„¤ì •
  - AmazonS3FullAccess
  - ë²„í‚· ìƒì„±
  - ë²„í‚· ê¶Œí•œ ì„¤ì •
  - ì´ë¯¸ì§€ ì—…ë¡œë“œ
  - react native S3 ì—°ë™
  - ì—…ë¡œë“œ URL ë°˜í™˜

date: 2024-01-04
last_modified_at: 2024-01-04
---

---

<!-- prettier-ignore -->
* this ordered seed list will be replaced by the toc 
{:toc}

## **ğŸ”¥ 1.  ì‚¬ì „ ì„¤ì¹˜**









```bash
yarn add react-native-url-polyfill 
yarn add react-native-image-picker 
yarn add @aws-sdk/client-s3 
yarn add @aws-sdk/lib-storage 
yarn add buffer 
yarn add react-native-get-random-values 
yarn add react-native-fs 

yarn add -D @aws-sdk/types 
yarn add @types/react-native-get-random-values
```

- `**react-native-image-picker` : ì•¨ë²” ì ‘ê·¼ ë° ì¹´ë©”ë¼ í—ˆìš© â‡’ ì´ë¯¸ì§€ ì—…ë¡œë“œë‹ˆ ë‹¹ì—°íˆ í•„ìš”**
- `**react-native-url-polyfill` : URL ê°ì²´ë¥¼ ì‚¬ìš©í•  ë•Œ í˜¸í™˜ì„± ê´€ë¦¬**
- `**@aws-sdk/client-s3` : S3 ë²„í‚·ì„ ìƒì„±í•˜ê±°ë‚˜ ì‚­ì œí•˜ê³ , ë²„í‚· ë‚´ ê°ì²´ ê´€ë¦¬ ë° ì—…ë¡œë“œì— í•„ìš”**
- `**@aws-sdk/lib-storage` : Amazon S3 (Simple Storage Service)ì™€ ê°™ì€ ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ íŒŒì¼ì„ ì—…ë¡œë“œ**
- `**buffer` : íŒŒì¼, ì´ë¯¸ì§€, ë„¤íŠ¸ì›Œí¬ í†µì‹  ë“± RNì—ì„œ ì´ì§„ ë°ì´í„°ë¥¼ ìœ„í•¨**
- `**react-native-get-random-values` : ë¬´ì‘ìœ„ ë°”ì´íŠ¸ë¥¼ ìƒì„± ì‘ì—…**
- `**react-native-fs` : ì´ë¯¸ì§€ íŒŒì¼ ì½ê¸° ì“°ê¸°**

## **ğŸ”¥ 2.  IAM ì„¤ì •**

### 1. ì‚¬ìš©ì ìƒì„±

<img width="500" alt="1" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/ad8ccd19-67b2-480f-a9ba-7e6f802d074a">

### 2. ì„¸ë¶€ ì •ë³´ ì§€ì •

<img width="500" alt="2" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/9783248e-5213-4c12-8de6-4e5c1f692967">

### 3. ê¶Œí•œ ì„¤ì • (AmazonS3FullAccess)

<img width="500" alt="3" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/c3a4a1e1-418f-4bbe-b7d3-a5a41a4bee77">

### 4. ì‚¬ìš©ì ìƒì„±

<img width="500" alt="4" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/8c5b7aeb-04b4-4dc2-aa7b-59c66d837f7a">

### 5. ì•¡ì„¸ìŠ¤ í‚¤ ë‹¤ìš´ë¡œë“œ


- `.csv` íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ
- ë‹¤ìš´ë¡œë“œ ê¸°íšŒëŠ” í•œë²ˆ

<img width="500" alt="5" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/2aff9170-d6fa-4cf4-89a1-d79df35010d4">

## **ğŸ”¥ 3.  ë²„í‚· ìƒì„±**

### 1. ì‚¬ìš©ì ìƒì„±

<img width="500" alt="6" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/655d07a1-416f-4402-8df4-3fb00dc260e1">

### 2. ë¦¬ì „ ì„ íƒ

<img width="500" alt="7" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/ce0ec08b-f6f1-4bc2-886b-dc20278b6828">

### 3. ê°ì²´ ì†Œìœ ê¶Œ

<img width="500" alt="8" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/1c7a2beb-4d22-4b48-b186-37c1fb02f1a9">

- AWS S3 ë²„í‚·ì—ì„œ ê°ì²´(íŒŒì¼)ì˜ ì†Œìœ ê¶Œì€ ì—…ë¡œë“œë¥¼ ìˆ˜í–‰í•œ IAM ì‚¬ìš©ì(ê³„ì •)ì—ê²Œ ìë™ìœ¼ë¡œ í• ë‹¹ëœë‹¤. ê°ì²´ì˜ ì†Œìœ ê¶Œì€ ê¸°ë³¸ì ìœ¼ë¡œ ì—…ë¡œë“œí•œ IAM ì‚¬ìš©ìì—ê²Œ ì†í•¨
- ACL(Access Control List)ì€ AWS S3 ë²„í‚·ì˜ ê°ì²´ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ â‡’ ì—…ë¡œë“œëœ ê°ì²´ì— ëŒ€í•œ ê³µê°œ ì½ê¸° ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©
- **ì—…ë¡œë“œë¥¼ ìˆ˜í–‰í•œ IAM ì‚¬ìš©ìì—ê²Œ ìë™ìœ¼ë¡œ í• ë‹¹**

### 4. í¼ë¸”ë¦­ ì—‘ì„¸ìŠ¤ ì„¤ì •

<img width="500" alt="9" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/b51e3b8f-7c93-4121-878b-0e8bd204d621">

- S3ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” URLì„ ì…ë ¥í•˜ì—¬ ì´ë¯¸ì§€ê°€ ì •ìƒì ìœ¼ë¡œ ì—…ë¡œë“œ
- ì‹¤ë¬´ì—ì„ Â **ëª¨ë“  í¼ë¸”ë¦­ ì•¡ì„¸ìŠ¤ ì°¨ë‹¨**

<img width="500" alt="10" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/2f40825f-5070-4c1f-8a39-f5b3c82c25ef">

- ë²„í‚·ì— ì €ì¥ë˜ëŠ” ê°ì²´ë¥¼ ìë™ìœ¼ë¡œ ì•”í˜¸í™”í•´ ì£¼ëŠ” ì„¤ì •

### 5. ì•”í˜¸í™” ì„¤ì •

<img width="500" alt="11" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/2e41b597-7840-4074-aa47-79b36938cd73">

### 6. ë²„í‚· ë§Œë“  í›„ ê¶Œí•œ ì„¤ì •

<img width="500" alt="12" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/66c023d6-d2aa-45fb-9b1c-821bd8375e2f">

<img width="500" alt="13" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/77bf5703-990b-43bd-9a70-7c22dbbfe1e4">





### 7. ë²„í‚· ê¶Œí•œ ì„¤ì •

```json
{

		{
		"Version": "2012-10-17",
		"Id": "Policy1686890931481",
		"Statement": [
		{
		"Effect": "Allow",
		"Principal": "",
		"Action": [
		"s3:GetObject",
		"s3:PutObject"
		],
		"Resource": "arn:aws:s3:::your-storage"
		}
	]
}
```

1. **ì •ì±… íƒ€ì… ì„ íƒ**
2. **ë²„í‚· ì •ì±…ì´ ì ìš©ë  ëŒ€ìƒ (ì „ì²´: *)**
3. **ë²„í‚·ì´ ìˆ˜í–‰í•  ì•¡ì…˜ (GetObject, PutObject ì„ íƒ)**
4. **ë²„í‚·ì— ì–´ë–¤ ë¦¬ì†ŒìŠ¤ì— ì ìš©í• ì§€ (ë²„í‚·ì´ë¦„/*)**



### 8. ì´ë¯¸ì§€ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸


<img width="500" alt="14" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/ffd90fbf-f426-4a6a-9524-d8149e428ee9">

<img width="500" alt="15" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/48be1361-fd4d-4a13-8a1c-565650ea13b6">

<img width="500" alt="16" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/7ab3773a-6101-4ffa-a198-4debb4545957">

<img width="500" alt="17" src="https://github.com/kdn0325/kdn0325.github.io/assets/91298955/c5cf2379-8a54-4e3f-ab88-a00d0d0ad78f">



## **ğŸ”¥ 3.  ì‹¤ì œ ì½”ë“œ ë°˜ì˜**

### 1. ì´ë¯¸ì§€ ë“±ë¡ í›„ S3ì— ì—…ë¡œë“œ

```tsx
import {
  ImageLibraryOptions,
  ImagePickerResponse,
  launchImageLibrary,
} from 'react-native-image-picker';

const chooseImage = async () => {
    const options: ImageLibraryOptions = {
      mediaType: 'photo', // ì¶”ê°€: ì›í•˜ëŠ” ë¯¸ë””ì–´ íƒ€ì…('photo', 'video' ë“±)ì„ ì§€ì •í•©ë‹ˆë‹¤.
    };

    launchImageLibrary(options, async (response: ImagePickerResponse) => {
      // ì´ë¯¸ì§€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œë¶€í„°ì˜ ì‘ë‹µ ì²˜ë¦¬
      if (response.didCancel) {
        console.log('ì‚¬ìš©ìê°€ ì´ë¯¸ì§€ ì„ íƒì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
      } else if (response.errorCode === 'camera_unavailable') {
        console.log('ì¹´ë©”ë¼ ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥ í•©ë‹ˆë‹¤');
      } else if (response.errorCode === 'permission') {
        console.log('ì¹´ë©”ë¼ ê¶Œí•œ ì„¤ì •ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤');
      } else {
        if (response.assets && response.assets.length > 0) {
          const {uri, fileName, type: fileType} = response.assets[0];

          try {
            const uploaded = await uploadToS3(uri, fileName, fileType);
            if (uploaded) {
              console.log('S3 ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ:', uploaded);
              setCertificateImage(uploaded);
            }
            // ì—…ë¡œë“œ ì„±ê³µ í›„ ì¶”ê°€ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          } catch (error) {
            console.error('S3 ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
          }
        } else {
          // ì„ íƒëœ ì´ë¯¸ì§€ê°€ ì—†ëŠ” ê²½ìš°ì˜ ì²˜ë¦¬
        }
      }
    });
  };
```

### 2. ì´ë¯¸ì§€ ë“±ë¡ í›„ S3ì— ì—…ë¡œë“œ

```tsx
const chooseImage = () => {
    const options: ImageLibraryOptions = {
      mediaType: 'photo', // ì¶”ê°€: ì›í•˜ëŠ” ë¯¸ë””ì–´ íƒ€ì…('photo', 'video' ë“±)ì„ ì§€ì •.
    };

    launchImageLibrary(options, (response: ImagePickerResponse) => {
      // ì´ë¯¸ì§€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œë¶€í„°ì˜ ì‘ë‹µ ì²˜ë¦¬
      if (response.didCancel) {
        console.log('ì‚¬ìš©ìê°€ ì´ë¯¸ì§€ ì„ íƒì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
      } else if (response.errorCode === 'camera_unavailable') {
        console.log('ì¹´ë©”ë¼ ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥ í•©ë‹ˆë‹¤');
      } else if (response.errorCode === 'permission') {
        console.log('ì¹´ë©”ë¼ ê¶Œí•œ ì„¤ì •ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤');
      } else {
        console.log(response);
        const selectedImageUri = response.assets && response.assets[0]?.uri;

        if (selectedImageUri) {
          setSelectedImage(selectedImageUri);
          setProfile(selectedImageUri.uri);
        } else {
          // ì„ íƒëœ ì´ë¯¸ì§€ê°€ ì—†ëŠ” ê²½ìš°ì˜ ì²˜ë¦¬
        }
      }
    });
  };
```

### 3. ì—…ë¡œë“œ í›„ URL ë°˜í™˜

```tsx
import {S3Client} from '@aws-sdk/client-s3';
import 'react-native-url-polyfill/auto';
import 'react-native-get-random-values';
import {Upload} from '@aws-sdk/lib-storage';
import {Buffer} from 'buffer';
import RNFS from 'react-native-fs';
import {AwsCredentialIdentity} from '@aws-sdk/types';
import Config from 'react-native-config';

const options = {
  keyPrefix: 'uploads/',
  bucket: Config.BUCKET,
  region: Config.REGION,
  successActionStatus: 201,
};

let credentials: AwsCredentialIdentity = {
  accessKeyId: Config.ACCESSKEYID || '',
  secretAccessKey: Config.SECRETACCESSKEY || '',
};

const client = new S3Client({
  region: options.region,
  credentials: credentials,
});

export async function uploadToS3(uri: any, name: any, type: any) {
  try {
    const file = {
      uri: uri,
      name: name,
      type: type,
    };

    const fileData = await RNFS.readFile(uri, 'base64');

    const upload = new Upload({
      client: client,
      params: {
        Bucket: Config.BUCKET,
        Key: 'uploads/' + file.name,
        Body: Buffer.from(fileData, 'base64'),
        ContentType: 'image/*',
      },
    });
    const response = await upload.done();
    console.log('response?', response);
    if (response && response.Location) {
      return response.Location.replace(
        `${Config.BUCKET}.s3.ap-northeast-2.amazonaws.com`,
        `s3.ap-northeast-2.amazonaws.com/${Config.BUCKET}`,
      );
    }
  } catch (error) {
    console.log('ì—ëŸ¬>', error);
    return false;
  }
}
```
